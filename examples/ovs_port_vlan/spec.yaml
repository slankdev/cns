
# DESCRIPTION: OVS port-vlan test
# TOPO:
#                 192.168.10.0/24
#   C0------------------+  +------------------C1
#      .1(net0)         |  |          .2(net0)
#                       [B0]
#      .1(net0)         |  |          .2(net0)
#   C2------------------+  +------------------C3
#                  192.168.20.0/24
#

nodes:
  - name: C0
    image: slankdev/ubuntu:16.04
    interfaces: [{ name: net0, type: bridge, opts: B0 }]
  - name: C1
    image: slankdev/ubuntu:16.04
    interfaces: [{ name: net0, type: bridge, opts: B0 }]
  - name: C2
    image: slankdev/ubuntu:16.04
    interfaces: [{ name: net0, type: bridge, opts: B0 }]
  - name: C3
    image: slankdev/ubuntu:16.04
    interfaces: [{ name: net0, type: bridge, opts: B0 }]

switches:
  - name: B0
    interfaces:
      - { name: net0, type: container, opts: C0 }
      - { name: net0, type: container, opts: C1 }
      - { name: net0, type: container, opts: C2 }
      - { name: net0, type: container, opts: C3 }

node_configs:
  - { name: C0, cmds: [ cmd: 'ip addr add 192.168.10.1/24 dev net0' ] }
  - { name: C1, cmds: [ cmd: 'ip addr add 192.168.10.2/24 dev net0' ] }
  - { name: C2, cmds: [ cmd: 'ip addr add 192.168.20.1/24 dev net0' ] }
  - { name: C3, cmds: [ cmd: 'ip addr add 192.168.20.2/24 dev net0' ] }

test:
  - cmds:
    - cmd: ovs-vsctl set port peer_C0_net0 tag=10
    - cmd: ovs-vsctl set port peer_C1_net0 tag=10
    - cmd: ovs-vsctl set port peer_C2_net0 tag=20
    - cmd: ovs-vsctl set port peer_C3_net0 tag=20
    - cmd: docker exec C0 ping -c2 192.168.10.2
    - cmd: docker exec C2 ping -c2 192.168.20.2

